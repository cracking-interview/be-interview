# 🍀 Spring & JPA

- 1. 프레임워크란
    - 프레임워크란 응용 프로그램이나 소프트웨어 솔루션 개발을 수월하기 위해 **구조, 틀이 제공된 소프트웨어 환경**이다.
- 2. Spring이란
    - 동적인 웹 사이트를 개발하기 위한 여러 가지 서비스를 제공하는 오픈소스 애플리케이션 프레임워크
    - 특징
        - POJO 기반의 구성으로 자바 코드를 이용해서 객체를 구성하는 방식 그대로 스프링에서 사용할 수 있다.
            - 덕분에 높은 생산성과 유연한 테스트를 할 수 있다.
        - DI(의존성 주입)을 통한 객체 관계 구성을 지원한다.
        - AOP(관점 지향 프로그래밍) 지원
        - MVC 구조로 계층이 분리되어 관리하기 수월하다.
        - 배치 애플리케이션 스프링 배치가 있다.
- 3. DI(Dependency Injection)
    - **DI는 스프링 프레임워크에서 지원하는 IoC의 형태** 이다.**클래스 사이의 의존관계를 빈 설정 정보를 바탕으로 컨테이너가 자동으로 연결해주는 것이다.**
    - 장점
        - **스프링 자체에서 설정을 통해 연관 관계를 맺어줌으로써 객체간 결합도를 낮춰준다.**
        - **클래스의 재사용성을 높이고, 유지보수가 편리해진다.**
        - 의존성 주입으로 인해 stub, mock 객체를 사용해 unit 테스트의 이점이 생긴다.
    - 단점
        - 의존성 주입을 위한 선행 작업이 필요해 간단한 프로그램에서는 번거롭다.
        - **코드 추적이 어렵다.**
- 4. 주입 방식
    - 필드 주입(`@Autowired`)
        - 외부에서 변경이 불가능해서 테스트하기 어렵다.
        
        ```java
        public class ExampleClass {
        	
            @Autowired
            private Example example;
        }
        ```
        
    - Setter 주입
        - 대부분 의존 관계 주입은 한번 일어나면 종료시점까지 변경할 일이 거의 없다.
        - Setter를 통해 주입하게 되면 변경될 위험이 존재
        - setter을 public으로 열어야함
        
        ```java
        public class ExampleClass {
        	
            private Example example;
            
            @Autowired
            public void setExample(Example example) {
            	this.example = example;
            }
        }
        ```
        
    - 생성자 주입(권장)
        - 생성자 호출 시점에 딱 1번만 호출되는 것을 보장
        - final 키워드를 통해 불변하게 설계 가능
        - 의존성 주입이 누락되는 것을 방지할 수 있음(IDE에서 컴파일 오류로 알려줌)
        
        ```java
        public class ExampleClass {
        	
            // final을 사용할 수 있다.
            private final Example example;
            
            @Autowired
            public ExampleClass(Example example) {
            	this.example = example;
            }
        }
        ```
        
- 5. IoC(Inverse of Control, 제어의 역전)
    - **객체의 생성부터 생명주기의 관리까지 모든 객체에 대한 제어권이 바뀐 것을 의미**한다.
    - 개발자는 프레임워크에 필요한 부품을 개발하고 조립하는 방식으로 개발을 하고 최종 호출은 개발자가 아니라 프레임워크의 내부에서 결정된 대로 이뤄지게 되는데 이런 현상을 제어의 역전이라고 한다.
- 6. 스프링 컨테이너
    - **스프링 컨테이너는 자바 객체의 생명 주기를 관리하며, 생성된 자바 객체들에게 추가적인 기능을 제공하는 역할을 한다.**
    - 스프링 컨테이너의 종류에는 BeanFactory와 **ApplicationContext**가 있다.
    - 둘 다 빈을 등록하고 생성하고 조회하고 돌려주는 등 빈을 관리하는 역할을 한다.
    - ApplicationContext가 BeanFactory의 빈 관리 기능들을 상속받았고, 그 외에 국제화 등의 추가적인 기능을 갖고 있어 스프링 컨테이너라고 하면 보통 ApplicationContext라고 한다.
- 7. Bean
    - **컨테이너 안에 들어있는 객체**
    - 필요할 때 컨테이너에서 가져와서 사용
    - `@Bean`을 사용해 등록하거나 xml을 사용해 등록하고, Bean으로 등록된 객체는 쉽게 주입하여 사용 가능
- 8. Bean 생명주기
    
    > 스프링 컨테이너 생성 -> 스프링 빈 생성 -> 의존 관계 주입 -> 초기화 콜백 -> 사용 -> 소멸전 콜백 -> 스프링 종료
    > 
    - 스프링 컨테이너에 의해 생명주기 관리
    - 스프링 컨테이너 초기화 시 빈 객체 생성, 의존 객체 주입 및 초기화
    - 생성과 의존관계 주입과 초기화 분리
        - 의존관계 주입(생성자 주입)은 필수정보를 받고 메모리 할당을 통해 객체 생성 책임
        - 초기화는 생성된 값들을 활용해 외부 커넥션을 연결하는 등 무거운 작업 수행
        - 명확하게 분리하는 것이 유지보수 관점에서 좋다.
    - 싱글톤 빈들은 컨테이너가 종료되기 직전에 소멸전 콜백이 발생
    - 초기화와 소멸 메서드는 애노테이션으로 **`@PostConstruct`, `@PreDestroy`** 를 사용하는 것이 권장된다.
- 9. 빈 스코프
    - Singleton Scope
        - 스프링 컨테이너 시작과 종료까지 1개의 객체로 유지
        - `@Component` 를 붙여 빈으로 등록
    - Prototype Scope
        - 빈의 생성, 의존관계 주입, 초기화까지만 관여하고 이후에는 컨테이너에서 관리하지 않는 스코프
        - **따라서 매번 요청마다 새로 만들어짐**
        - `@Scope(value = "prototype")` 를 붙여 설정
    - 웹 스코프
        
        : 웹환경에서만 동작하는 스코프입니다 .
        
        - request
            - HTTP 요청이 들어오고 나갈때까지 유지되는 스코프
            - 각각의 HTTP 요청마다 별도의 빈 인스턴스가 생성되고 관리됨
        - session : HTTP 세션과 동일한 생명주기를 가지는 스코프
        - application : 웹의 서블릿 컨텍스트와 동일한 생명주기를 갖는 스코프
            - 서블릿 컨텍스트는 **web application내에 있는 모든 서블릿들을 관리하며 정보공유할 수 있게 도와 주는 역할** 을 하는데, 톰캣 컨테이너가 실행 시 애플리케이션 하나당 한개의 서블릿컨텍스트가 생성된다.
            - 생명 주기는 보통 톰캣의 시작과 종료와 일치한다.